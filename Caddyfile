# Auto-detect: if CADDY_DOMAIN is set to a .ts.net hostname, use certs
# Otherwise, serve on port 80 without TLS

{$CADDY_DOMAIN::80} {
    reverse_proxy frontend:3000
    
    header {
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
    }
}

# For Tailscale HTTPS, set CADDY_DOMAIN=hostname.tail*.ts.net
# and mount certs to /certs/
